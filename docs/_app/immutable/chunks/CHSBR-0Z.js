import{c as m,e as E,s as M}from"./CKiNHVVP.js";import{G as k,a_ as b,b4 as N}from"./iq6ECR_1.js";const S=[];function x(e,t=!1,n=!1){return f(e,new Map,"",S,null,n)}function f(e,t,n,s,o=null,i=!1){if(typeof e=="object"&&e!==null){var r=t.get(e);if(r!==void 0)return r;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(k(e)){var a=Array(e.length);t.set(e,a),o!==null&&t.set(o,a);for(var c=0;c<e.length;c+=1){var H=e[c];c in e&&(a[c]=f(H,t,n,s,null,i))}return a}if(b(e)===N){a={},t.set(e,a),o!==null&&t.set(o,a);for(var y in e)a[y]=f(e[y],t,n,s,null,i);return a}if(e instanceof Date)return structuredClone(e);if(typeof e.toJSON=="function"&&!i)return f(e.toJSON(),t,n,s,e)}if(e instanceof EventTarget)return e;try{return structuredClone(e)}catch{return e}}function C(e){return typeof e=="object"&&e!==null&&"toKey"in e&&typeof e.toKey=="function"}class K{#t;#e;constructor(t=!1){this.#t=new Map,this.#e=t}add(t,n){this.addValues(t,[n])}addValues(t,n){const s=this.normalizeKey(t);let o=this.#t.get(s);o?o=o.concat(n):o=n,this.#e?this.#t.set(s,[...new Set(o)]):this.#t.set(s,o)}removeValues(t,n){const s=this.normalizeKey(t);let o=this.#t.get(s);o&&(n.forEach(i=>{o.indexOf(i)>-1&&o.splice(o.indexOf(i),1)}),o.length==0&&this.#t.delete(s))}remove(t,n){this.removeValues(t,[n])}get(t){return this.#t.get(this.normalizeKey(t))??[]}has(t){return this.#t.has(this.normalizeKey(t))}normalizeKey(t){return C(t)?t.toKey():t}}const l={"ctrl|option":0,shift:1,alt:2};class h{key;#t;constructor(t,...n){this.key=t.toLowerCase(),this.#t=[!1,!1,!1];for(const s of n){const o=l[s];this.#t[o]=!0}}get ctrlOrOption(){return this.#t[l["ctrl|option"]]}get shift(){return this.#t[l.shift]}get alt(){return this.#t[l.alt]}toKey(){return`${this.#t.map(n=>n?"1":"0").join("")}:${this.key}`}equals(t){return this.toKey()===t.toKey()}toString(){let t=[];return this.#t[l["ctrl|option"]]&&t.push("Ctrl"),this.#t[l.shift]&&t.push("Shift"),this.#t[l.alt]&&t.push("Alt"),t.push(this.key.toUpperCase()),t.join("+")}static fromEvent(t){const n=[];return(t.ctrlKey||t.metaKey)&&n.push("ctrl|option"),t.shiftKey&&n.push("shift"),t.altKey&&n.push("alt"),new h(t.key,...n)}}class d{#t=!1;#e=new K(!0);#n=this.#s.bind(this);assignHotKey(t,n){if(console.debug("HotkeysModule assigning key:",t,"to handler:",n.toString()),!this.#t)throw new Error(`${d.name} Need to initialize Class before assigning hotkeys`);this.#e.add(t,n)}removeHotKey(t,n){this.#e.remove(t,n)}assignHotKeys(t,n){t.forEach(s=>this.assignHotKey(s,n))}removeHotKeys(t,n){t.forEach(s=>this.removeHotKey(s,n))}#s(t){let n=this.#e,s=h.fromEvent(t),o=n.get(s);console.debug("HotkeysModule - reachedKeydownEvent key:",s.toKey(),"relevantHandlers",o?.length),o?.forEach(i=>i(t))}init(){if(this.#t)throw new Error(`${d.name} Was already initialized`);document.addEventListener("keydown",this.#n),this.#t=!0}destroy(){document.removeEventListener("keydown",this.#n),this.#e=new K,this.#t=!1}}const u=new d;class g{#t=[];register(t){this.#t.indexOf(t)==-1&&this.#t.push(t)}unregister(t){let n=this.#t.indexOf(t),s=!1;return n!=-1&&(this.#t.splice(n,1),s=!0),s}signal(t){console.debug("signal dispatching to handler count:",this.#t.length,"signal",t),this.#t.forEach(n=>{console.debug("dispaching Singal",t,"to handler",n.toString());try{n(t)}catch(s){console.error("failed handling for handler",s)}})}}class O{#t=0;get navigationMode(){return this.#t}set#e(t){console.log("reached setNavigationMode2",t,this.#t),t!=this.#t&&(console.log("reached setMouseNavigationMode3"),console.debug("StateManager Mode Change. Setting New mode:",t),this.#t=t,this.#n.signal(t))}#n=new g;setMouseNavigationMode(){console.log("setNavigationMode1 Mouse"),this.#e=0}setKeyboardNavigationMode(){console.log("setNavigationMode1 Keyboard"),this.#e=1}registerNavigationModeChange(t){this.#n.register(t)}unregisterNavigationModeChange(t){return this.#n.unregister(t)}}const v=new O;function z(e){v.setKeyboardNavigationMode(),e.focus({preventScroll:!0}),e.scrollIntoView({behavior:"smooth",block:"nearest"});const t=e;t&&t.select()}const D=new g,I=new g;function $(e,t){D.signal({key:e,targetNode:t})}function T(e,t){I.signal({key:e,targetNode:t})}const F="data-hotkey-tooltip",p=E.buttonRapidFireCooldownMs;function B(e="",t,...n){const s=new h(t,...n);return o=>{const i=o;if(!i)throw new Error(`Expected node to be HTML Element. Node: ${o}`);let r=L(i,s);return u.assignHotKey(s,r),w(o,s,e),()=>{u.removeHotKey(s,r)}}}function J(e="",t,...n){const s=new h(t,...n);return o=>{const i=o;if(!i)throw new Error(`Expected node to be HTML Element. Node: ${o}`);let r=V(i,s.key);return u.assignHotKey(s,r),w(o,s,e),()=>{u.removeHotKey(s,r)}}}function L(e,t){return m(n=>{n.target!==e&&(z(e),T(t.key,e))},{cooldownDelay:p,context:`focus node: [${e.toString()}]`,shouldExecuteFunction:n=>!M(n)})}function V(e,t){return m(n=>{e.click(),$(t,e)},{cooldownDelay:p,context:`click node: [${e.toString()}]`})}function w(e,t,n){e.setAttribute(F,`${n} (${t.toString()})`)}function W(...e){x(e)}export{F as H,J as a,B as c,u as h,x as s,W as t};
