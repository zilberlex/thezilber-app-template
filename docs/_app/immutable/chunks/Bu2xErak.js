import{c as u,e as f,s as y}from"./CKiNHVVP.js";function K(o){return typeof o=="object"&&o!==null&&"toKey"in o&&typeof o.toKey=="function"}class d{#e;#t;constructor(e=!1){this.#e=new Map,this.#t=e}add(e,t){this.addValues(e,[t])}addValues(e,t){const n=this.normalizeKey(e);let s=this.#e.get(n);s?s=s.concat(t):s=t,this.#t?this.#e.set(n,[...new Set(s)]):this.#e.set(n,s)}removeValues(e,t){const n=this.normalizeKey(e);let s=this.#e.get(n);s&&(t.forEach(i=>{s.indexOf(i)>-1&&s.splice(s.indexOf(i),1)}),s.length==0&&this.#e.delete(n))}remove(e,t){this.removeValues(e,[t])}get(e){return this.#e.get(this.normalizeKey(e))??[]}has(e){return this.#e.has(this.normalizeKey(e))}normalizeKey(e){return K(e)?e.toKey():e}}const a={"ctrl|option":0,shift:1,alt:2};class r{key;#e;constructor(e,...t){this.key=e.toLowerCase(),this.#e=[!1,!1,!1];for(const n of t){const s=a[n];this.#e[s]=!0}}get ctrlOrOption(){return this.#e[a["ctrl|option"]]}get shift(){return this.#e[a.shift]}get alt(){return this.#e[a.alt]}toKey(){return`${this.#e.map(t=>t?"1":"0").join("")}:${this.key}`}equals(e){return this.toKey()===e.toKey()}static fromEvent(e){const t=[];return(e.ctrlKey||e.metaKey)&&t.push("ctrl|option"),e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),new r(e.key,...t)}}class l{#e=!1;#t=new d(!0);#o=this.#n.bind(this);assignHotKey(e,t){if(console.debug("HotkeysModule assigning key:",e,"to handler:",t.toString()),!this.#e)throw new Error(`${l.name} Need to initialize Class before assigning hotkeys`);this.#t.add(e,t)}removeHotKey(e,t){this.#t.remove(e,t)}assignHotKeys(e,t){e.forEach(n=>this.assignHotKey(n,t))}removeHotKeys(e,t){e.forEach(n=>this.removeHotKey(n,t))}#n(e){let t=this.#t,n=r.fromEvent(e),s=t.get(n);console.debug("HotkeysModule - reachedKeydownEvent key:",n.toKey(),"relevantHandlers",s?.length),s?.forEach(i=>i(e))}init(){if(this.#e)throw new Error(`${l.name} Was already initialized`);document.addEventListener("keydown",this.#o),this.#e=!0}destroy(){document.removeEventListener("keydown",this.#o),this.#t=new d,this.#e=!1}}const c=new l;class h{#e=[];register(e){this.#e.indexOf(e)==-1&&this.#e.push(e)}unregister(e){let t=this.#e.indexOf(e),n=!1;return t!=-1&&(this.#e.splice(t,1),n=!0),n}signal(e){console.debug("signal dispatching to handler count:",this.#e.length,"signal",e),this.#e.forEach(t=>{console.debug("dispaching Singal",e,"to handler",t.toString());try{t(e)}catch(n){console.error("failed handling for handler",n)}})}}class m{#e=0;get navigationMode(){return this.#e}set#t(e){console.log("reached setNavigationMode2",e,this.#e),e!=this.#e&&(console.log("reached setMouseNavigationMode3"),console.debug("StateManager Mode Change. Setting New mode:",e),this.#e=e,this.#o.signal(e))}#o=new h;setMouseNavigationMode(){console.log("setNavigationMode1 Mouse"),this.#t=0}setKeyboardNavigationMode(){console.log("setNavigationMode1 Keyboard"),this.#t=1}registerNavigationModeChange(e){this.#o.register(e)}unregisterNavigationModeChange(e){return this.#o.unregister(e)}}const w=new m;function H(o){w.setKeyboardNavigationMode(),o.focus({preventScroll:!0}),o.scrollIntoView({behavior:"smooth",block:"nearest"})}const v=new h,p=new h;function E(o,e){v.signal({key:o,targetNode:e})}function M(o,e){p.signal({key:o,targetNode:e})}const g=f.buttonRapidFireCooldownMs;function O(o,...e){const t=new r(o,...e);return n=>{const s=n;if(!s)throw new Error(`Expected node to be HTML Element. Node: ${n}`);let i=k(s,t);return c.assignHotKey(t,i),()=>{c.removeHotKey(t,i)}}}function S(o,...e){const t=new r(o,...e);return n=>{const s=n;if(!s)throw new Error(`Expected node to be HTML Element. Node: ${n}`);let i=N(s,t.key);return c.assignHotKey(t,i),()=>{c.removeHotKey(t,i)}}}function k(o,e){return u(t=>{t.target!==o&&(H(o),M(e.key,o))},{cooldownDelay:g,context:`focus node: [${o.toString()}]`,shouldExecuteFunction:t=>!y(t)})}function N(o,e){return u(t=>{o.click(),E(e,o)},{cooldownDelay:g,context:`click node: [${o.toString()}]`})}export{S as a,O as c,c as h};
